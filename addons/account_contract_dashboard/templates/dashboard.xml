<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>

  <template id="dashboard" name="Recurrent Revenue Dashboard" page="True">
    <t t-name="account_contract_dashboard.dashboard"/>
    <t t-call="website.layout">
    <div id="wrap" class="oe_structure oe_empty" style="background-color: #ebf1f4;">
      <div class="container">
          
          <div class="row">              
            <div class="col-sm-12 text-center">
              <h1 class="text-muted ">Recurrent Revenue Dashboard</h1>
            </div>
          </div>

          <hr/>

          <div class="row mb32">
            <form action="/account_contract_dashboard">
              <div class="col-sm-4 text-left">
                <a t-att-class="'' if filtered_contract_template_ids else 'collapsed'" data-toggle="collapse" href="#collapse_filter_contracts">
                  Filter on contracts
                </a>

                <div role="tablist" aria-multiselectable="true">
                  <div id="collapse_filter_contracts" t-att-class="'panel-collapse collapse in' if filtered_contract_template_ids else 'panel-collapse collapse'" role="tabpanel">
                    <t t-foreach="contract_templates" t-as="template">
                      <div class="checkbox">
                        <input type="checkbox" t-att-checked="'checked' if str(template.id) in filtered_contract_template_ids else ''" name="contract_template_filter" t-att-value="template.id"><t t-esc="template.name"/></input>
                      </div>
                    </t>
                  </div>
                </div>
              </div>
              <div class="col-sm-8 text-right">
                <input type="date" name="start_date" t-att-value="start_date"/> to <input type="date" name="end_date" t-att-value="end_date"/> <button class="btn btn-primary" type="submit">Update</button>
              </div>
            </form>
          </div>

          <div class="row">
            <t t-foreach="all_stats" t-as="stat">
              <div class="col-sm-4">
                <a class="fill-div" t-att-href="'account_contract_dashboard/detailed/%s?%s' % (stat['code'], href_post_args)">
                  <div class="box stat-box" t-att-name="stat['name']" t-att-code="stat['code']">
                    <div class="loading">
                      <div id="big-circle">
                        <div id="little-circle">
                        </div>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            </t>
          </div>

      </div>

    </div>
    </t>
  </template>

  <template id="detailed_dashboard" name="Detailed Dashboard" page="True">
    <t t-name="account_contract_dashboard.detailed_dashboard"/>
    <t t-call="website.layout">
    <div id="wrap" class="oe_structure oe_empty" style="background-color: #ebf1f4;">
      <div class="container">
          
          <div class="row">              
            <div class="col-sm-12 text-center">
              <h1 class="text-muted "><t t-esc="report_name"/></h1>
            </div>
          </div>

          <hr/>

          <div class="row mb32">
            <form t-att-action="'/account_contract_dashboard/detailed/%s' % stat_type">
              <div class="col-sm-4 text-left">
                <div>
                  <a t-att-href="'/account_contract_dashboard?%s' % href_post_args">Dashboard</a>
                </div>
                <a t-att-class="'' if filtered_contract_template_ids else 'collapsed'" data-toggle="collapse" href="#collapse_filter_contracts">
                  Filter on contracts
                </a>

                <div role="tablist" aria-multiselectable="true">
                  <div id="collapse_filter_contracts" t-att-class="'panel-collapse collapse in' if filtered_contract_template_ids else 'panel-collapse collapse'" role="tabpanel">
                    <t t-foreach="contract_templates" t-as="template">
                      <div class="checkbox">
                        <input type="checkbox" t-att-checked="'checked' if str(template.id) in filtered_contract_template_ids else ''" name="contract_template_filter" t-att-value="template.id"><t t-esc="template.name"/></input>
                      </div>
                    </t>
                  </div>
                </div>
              </div>
              <div class="col-sm-8 text-right">
                <input type="date" name="start_date" t-att-value="start_date"/> to <input type="date" name="end_date" t-att-value="end_date"/> <button class="btn btn-primary" type="submit">Update</button>
              </div>
            </form>
          </div>

          <div class="row box">
            <div class="col-sm-12">
              <h1 class="metric_current oBlue mt32 mb32"><t t-esc="value_now['value']"/><t t-esc="all_stats[stat_type]['add_symbol']"/></h1>
            </div>
            <input type="hidden" name="stat_type" t-att-value="stat_type"/>
            <div id="stat_chart_div">
              <!-- <svg style="height:20em;"></svg> -->
            </div>
          </div>

          <div class="row box">
            <div class="col-md-3 text-center">
              <h4 class="text-muted smallCaps">Current</h4>
              <h2><t t-esc="value_now['value']"/><t t-esc="all_stats[stat_type]['add_symbol']"/></h2>
            </div>


            <div class="col-md-3 text-center">
              <h4 class="text-muted smallCaps">1 month ago</h4>
              <h2><t t-esc="value_1_month_ago['value']"/><t t-esc="all_stats[stat_type]['add_symbol']"/> <small t-if="not value_1_month_ago['value'] == 0" t-attf-class="#{rate(stat_type, value_1_month_ago['value'], value_now['value'])[1]}"><t t-esc="rate(stat_type, value_1_month_ago['value'], value_now['value'])[0]"/>%</small></h2>
            </div>


            <div class="col-md-3 text-center">
              <h4 class="text-muted smallCaps">3 months ago</h4>
              <h2><t t-esc="value_3_months_ago['value']"/><t t-esc="all_stats[stat_type]['add_symbol']"/> <small t-if="not value_3_months_ago['value'] == 0" t-attf-class="#{rate(stat_type, value_3_months_ago['value'], value_now['value'])[1]}"><t t-esc="rate(stat_type, value_3_months_ago['value'], value_now['value'])[0]"/>%</small></h2>
            </div>


            <div class="col-md-3 text-center">
              <h4 class="text-muted smallCaps">12 months ago</h4>
              <h2><t t-esc="value_12_months_ago['value']"/><t t-esc="all_stats[stat_type]['add_symbol']"/> <small t-if="not value_12_months_ago['value'] == 0" t-attf-class="#{rate(stat_type, value_12_months_ago['value'], value_now['value'])[1]}"><t t-esc="rate(stat_type, value_12_months_ago['value'], value_now['value'])[0]"/>%</small></h2>
            </div>
          </div>

          <div t-if="stat_type == 'mrr'" class="row box">
            <div class="col-sm-12 mrr_growth_chart">
              <h3>Monthly Recurring Revenue Growth</h3>
              <div id="mrr_growth_chart_div">
                <!-- <svg style="height:20em;"></svg> -->
              </div>

<!--               <hr/>

              <div class="col-sm-2 text-center">
                <h4>New MRR</h4>
                <strong id="new_mrr_metric" class="oGreen">0</strong>
              </div>
              <div class="col-sm-1">
                <i class="fa fa-plus-square-o"></i>
              </div>
              <div class="col-sm-2 text-center">
                <h4>Expansion MRR</h4>
                <strong id="new_mrr_metric" class="oYellow">0</strong>
              </div>
              <div class="col-sm-1">
                <i class="fa fa-minus-square-o"></i>
              </div>
              <div class="col-sm-2 text-center">
                <h4>Churned MRR</h4>
                <strong id="new_mrr_metric" class="oRed">0</strong>
              </div>
              <div class="col-sm-1">
                <i class="fa fa-minus-square-o"></i>
                <i class="fa fa-minus-square-o"></i>
              </div>
              <div class="col-sm-2 text-center">
                <h4>Net New MRR</h4>
                <strong id="new_mrr_metric" class="oBlue">0</strong>
              </div> -->
            </div>
          </div>

          <div t-if="stats_by_plan" class="row box">
            <table class="table table-striped">
              <tr>
                <th>Plan</th>
                <th># of Contracts</th>
                <th t-if="not stat_type == 'nb_contracts'"><t t-esc="report_name"/></th>
                <th></th>
              </tr>
              <t t-foreach="stats_by_plan" t-as="plan">
                <tr>
                  <td><t t-esc="plan['name']"/></td>
                  <td t-att-class="'oGreen' if plan['nb_customers'] > 0 else 'grey'"><t t-esc="plan['nb_customers']"/></td>
                  <td t-if="not stat_type == 'nb_contracts'" t-att-class="'oGreen' if plan['value'] > 0 else 'grey'"><t t-esc="plan['value']"/><t t-esc="all_stats[stat_type]['add_symbol']"/></td>
                  <td>
                    <div t-if="not value_now['value'] == 0" class="progress" style="width:80%; height:10px;">
                      <div class="progress-bar" role="progressbar" t-att-aria-valuenow="'{0}'.format(100*(plan['value'])/float(value_now['value']))" aria-valuemin="0" aria-valuemax="100" t-att-style="'width: {0}%'.format(100*(plan['value'])/float(value_now['value']))">
                        <span class="sr-only"><t t-esc="'{0}'.format(100*(plan['value'])/float(value_now['value']))"/>% Complete (success)</span>
                      </div>
                    </div>
                  </td>
                </tr>
              </t>
            </table>
          </div>

      </div>

    </div>
    </t>
  </template>
   
  </data>
</openerp>